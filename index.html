
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KaraOwkie!</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Orbitron', sans-serif;
      background-color: #000;
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .screen { display: none; flex-grow: 1; flex-direction: column; align-items: center; justify-content: center; }
    .active { display: flex !important; }
    .title {
      font-size: 2.5em;
      margin: 30px 0;
      color: cyan;
      text-shadow: 0 0 5px cyan, 0 0 10px cyan;
      animation: blink 1.5s infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .neon-button {
      background-color: black;
      color: white;
      border: 2px solid cyan;
      padding: 15px 30px;
      font-size: 1em;
      border-radius: 10px;
      margin: 10px;
      cursor: pointer;
    }
    .neon-button:hover {
      background-color: cyan;
      color: black;
    }
    .input-box {
      background-color: white;
      color: black;
      padding: 10px;
      border-radius: 10px;
      width: 80%;
      margin: 10px 0;
      font-size: 1em;
    }
    iframe { width: 100%; height: 40vh; border: none; }
    #queueList {
      flex-grow: 1;
      width: 100%;
      background: #111;
      overflow-y: auto;
      padding: 10px;
    }
    .queue-item {
      padding: 8px;
      border-bottom: 1px solid #333;
    }
  </style>
</head>
<body>

  <div class="screen active" id="homeScreen">
    <h1 class="title">KaraOwkie!</h1>
    <p style="text-align:center;">Turn on your Hotspot now if you're the host.<br>Join via Wi-Fi if you're a guest.</p>
    <button class="neon-button" onclick="switchScreen('roomScreen')">Enter Room</button>
  </div>

  <div class="screen" id="roomScreen">
    <iframe id="ytPlayer" src="https://www.youtube.com/embed/M7lc1UVf-VE?autoplay=1&controls=1"></iframe>

    <input id="youtubeLink" class="input-box" type="text" placeholder="Paste YouTube link here">
    <button class="neon-button" onclick="reserveLink()">Reserve</button>

    <div id="queueList"></div>
  </div>

  <script src="http://192.168.1.109:3000/socket.io/socket.io.js"></script>
  <script>
    const socket = io("http://192.168.1.109:3000");
    const queueList = document.getElementById("queueList");

    socket.on("connect", () => {
      console.log("Connected:", socket.id);
      socket.emit("join-room", "karaowkie-room");
    });

    socket.on("queue-update", (queue) => {
      queueList.innerHTML = "";
      queue.forEach(item => {
        const div = document.createElement("div");
        div.className = "queue-item";
        div.textContent = item.title || item.videoId;
        queueList.appendChild(div);
      });
    });

    socket.on("play-next", (video) => {
      if (video.videoId) {
        document.getElementById("ytPlayer").src =
          "https://www.youtube.com/embed/" + video.videoId + "?autoplay=1&controls=1";
      }
    });

    function switchScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function reserveLink() {
      const url = document.getElementById("youtubeLink").value;
      const videoId = extractYouTubeID(url);
      if (!videoId) return alert("Invalid YouTube link!");
      socket.emit("reserve-video", { videoId, title: "Reserved Video" });
      document.getElementById("youtubeLink").value = "";
    }

    function extractYouTubeID(url) {
      const regExp = /(?:v=|\/embed\/|\.be\/)([a-zA-Z0-9_-]{11})/;
      const match = url.match(regExp);
      return match ? match[1] : null;
    }
  </script>
</body>
</html>
