<!-- REPLACE YOUR SCRIPT TAG IN <body> WITH THIS ONE -->
<script>
  let isHost = true; // Later: this determines who controls playback

  const queue = []; // Holds queued videos

  function reserveFromDrawer() {
    const url = document.getElementById("youtubeInputDrawer").value.trim();
    if (!url) return alert("Please paste a YouTube URL.");

    const videoId = extractYouTubeID(url);
    if (!videoId) return alert("Invalid YouTube URL.");

    // Try to get video title (optional)
    fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`)
      .then(res => res.json())
      .then(data => {
        const title = data.title || "Untitled Video";

        // Add to queue
        queue.push({ videoId, title });
        updateQueueUI();

        alert("ðŸŽ¤ Reserved: " + title);

        // Autoplay if first in queue
        if (queue.length === 1) {
          playNextFromDrawer();
        }
      })
      .catch(err => {
        queue.push({ videoId, title: "Unknown Title" });
        updateQueueUI();
        alert("ðŸŽ¤ Reserved! (Title not found)");

        if (queue.length === 1) {
          playNextFromDrawer();
        }
        console.error("Title fetch failed:", err);
      });

    // Clear input
    document.getElementById("youtubeInputDrawer").value = "";
  }

  function playNextFromDrawer() {
    if (queue.length === 0) {
      document.getElementById("nowTitle").textContent = "Nothing in queue.";
      document.getElementById("player").src = "";
      return;
    }

    const next = queue.shift(); // Remove first
    updateQueueUI();

    // Play video
    const player = document.getElementById("player");
    player.src = `https://www.youtube.com/embed/${next.videoId}?enablejsapi=1&autoplay=1`;

    document.getElementById("nowTitle").textContent = next.title;
  }

  function updateQueueUI() {
    const nextBox = document.querySelector(".next-box");
    nextBox.innerHTML = `<div class="label">NEXT</div>`;

    if (queue.length === 0) {
      const empty = document.createElement("div");
      empty.className = "title";
      empty.textContent = "No songs in queue.";
      nextBox.appendChild(empty);
      return;
    }

    queue.forEach(item => {
      const div = document.createElement("div");
      div.className = "title";
      div.textContent = item.title;
      nextBox.appendChild(div);
    });
  }

  function extractYouTubeID(url) {
    const match = url.match(/(?:youtu\.be\/|v=)([^&]+)/);
    return match ? match[1] : null;
  }

  // Initial state check (e.g., if user is not host)
  if (!isHost) {
    document.getElementById("nextBtnDrawer").style.display = "none";
  }
</script>
