
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KaraOwkie - Room</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Orbitron', sans-serif;
      background-color: #0a0a0a;
      color: white;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    .title-bar {
      text-align: center;
      font-size: 1.6em;
      padding: 12px 0;
      color: white;
      text-shadow: 0 0 5px cyan, 0 0 15px cyan;
      background-color: #000;
      position: relative;
      animation: neon 1.5s ease-in-out infinite alternate;
    }
    @keyframes neon {
      from { text-shadow: 0 0 10px cyan, 0 0 20px cyan; }
      to { text-shadow: 0 0 20px magenta, 0 0 40px magenta; }
    }
    }
    
    .refresh-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.5em;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      z-index: 200;
    }

    .drawer {
      position: fixed;
      top: 0;
      left: -240px;
      width: 220px;
      height: 100%;
      background: rgba(20, 20, 20, 0.90);
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.5);
      z-index: 99;
      transition: left 0.3s ease;

      display: flex;
      flex-direction: column;
      justify-content: space-around;
      height: 50%;
    }
    .drawer.open { left: 0; }
    
    .drawer-handle {
      position: absolute;
      top: 0%;
      right: -50px;
      width: 50px;
      height: 50px;
      background: rgba(0, 0, 0, 0.0);
      color: magenta;
      font-size: 1.6em;
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: right;
      cursor: pointer;
      z-index: 80;
    }
    
    .nowplaying-box {
      border: 2px solid cyan;
      border-radius: 10px;
      padding: 10px;
      background: #121212;
    }
    
    .nowplaying-box .label {
      font-size: 0.7em;
      color: #aaa;
    }

    .nowplaying-box .title {
      font-size: 1.1em;
      margin: 5px 0;
      word-wrap: break-word;
    }
    
    .next-box {
      border: none;
      border-radius: 10px;
      padding: 10px;
      background: #121212;
    }
    
    .next-box .label {
      font-size: 0.7em;
      color: #aaa;
    }
    
    .next-box .title {
      font-size: 0.9em;
      margin: 10px 0;
      word-wrap: break-word;
    }
    
    .leave-btn {
      width: 100%;
      padding: 12px;
      background: magenta;
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: 0.3s;
    }
    
    .leave-btn:hover {
      background: deeppink;
      color: white;
    }

    .drawer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.4);
      z-index: 90;
      display: none;
    }
    .drawer-overlay.visible { display: block; }
    .bottomDrawerOverlay.visible { display: block; }

    .youtube-wrapper {
      width: 100%;
      height: 70vh;
      border: 5px solid cyan;
      margin-top: 2vh;
      margin-bottom: 5vh;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .url-input {
      width: calc(100% - 20px);
      margin: 0 10px 8px 10px;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid cyan;
      font-size: 1em;
      background-color: white;
      color: black;
      text-align: center;
    }

    .bottom-buttons {
      position: fixed;
      bottom: 15px;
      width: 100%;
      padding: 0 10px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      z-index: 5;
    }

    .cyan-btn {
      flex: 1;
      padding: 14px;
      background: #121212;
      border: 2px solid cyan;
      border-radius: 10px;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: 0.3s;
    }

    .cyan-btn:hover {
      background: cyan;
      color: black;
    }
    
    .bottom-drawer {
      position: fixed;
      bottom: -160px;
      left: 0;
      width: 100%;
      background: rgba(20, 20, 20, 0.95);
      padding: 20px 15px 25px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
      transition: bottom 0.3s ease;
      z-index: 98;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .bottom-drawer.open {
      bottom: 0;
    }
    
    .bottom-drawer-handle {position: absolute;
      top: -50px;
      left: 50%;
      transform: translateX(-50%);
      background: none;
      border: none;
      color: magenta;
      font-size: 1.8em;
      cursor: pointer;
      text-shadow: 0 0 6px magenta, 0 0 12px magenta;
      z-index: 99;
      transition: opacity 0.3s ease;
    }
    .bottom-drawer-handle[style*="display: none"] {
      opacity: 0;
    }
    
    .bottom-buttons.inside {
      position: relative;
      bottom: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    @media (orientation: landscape) {
      .youtube-wrapper {
        height: 75vh;
      }
      .drawer {
        height: 100vh; /* Full screen height in landscape */
        justify-content: space-between; /* Keep space for top + bottom parts */
        padding-bottom: 20px; /* Add some space at the bottom */
      }
      
      .url-input, .search-bar {
        display: block; /* Make sure it's visible */
      }
      
      .bottom-buttons, .leave-btn {
        position: relative;
        bottom: 0;
        margin-top: auto; /* Push to bottom inside flex column */
      }
    }

    @media (max-height: 500px) {
      .bottom-buttons { position: static; margin-top: 20px; }
    }
  </style>
</head>
<body ontouchstart="handleTouchStart(event)" ontouchmove="handleTouchMove(event)" onclick="handleTap(event)">

  <!-- Title -->
  <div class="title-bar">KaraOwkie!</div>
  <button type="button" class="refresh-btn" onclick="refreshApp()">âŸ³</button>
    
  <!-- Drawer -->
  <div class="drawer" id="drawer">
     <div id="drawerHandle" class="drawer-handle" onclick="toggleDrawer()">â˜°</div>
    <div>
      <div class="nowplaying-box">
        <div class="label">NOW PLAYING</div>
        <div class="title" id="nowTitle">Sample Song Title</div>
      </div>
    </div>
    <div>
      <div class="next-box">
        <div class="label">NEXT</div>
        <div class="title">Sample Song 1</div>
        <div class="title">Sample Song 2</div>
        <div class="title">Sample Song 3</div>
        <div class="title">Sample Song 4</div>
      </div>
    </div>
    <button class="leave-btn" onclick="leaveRoom()">Leave Room</button>
  </div>
  <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
  <div class="drawer-overlay" id="bottomDrawerOverlay" onclick="closeBottomDrawer()"></div>

  <!-- YouTube Player -->
  <div class="youtube-wrapper">
    <iframe id="player" src="https://www.youtube.com/embed/M7lc1UVf-VE?enablejsapi=1&controls=1&autoplay=1"></iframe>
  </div>

  <!-- Bottom Drawer -->
  <div class="bottom-drawer" id="bottomDrawer">
  <button class="bottom-drawer-handle" onclick="toggleBottomDrawer()">â–²</button>
  
  <input type="text" class="url-input" placeholder="Paste the YouTube URL here" id="youtubeInputDrawer" />
  
  <div class="bottom-buttons inside">
    <button class="cyan-btn" onclick="reserveFromDrawer()">Reserve</button>
    <button class="cyan-btn" id="nextBtnDrawer" onclick="playNextFromDrawer()">Next</button>
  </div>
</div>

  <!-- JS -->
  <script>
    let isHost = true; // Later: this determines who controls playback

    const queue = []; // Holds queued videos
  
    function reserveFromDrawer() {
      const url = document.getElementById("youtubeInputDrawer").value.trim();
      if (!url) return alert("Please paste a YouTube URL.");
  
      const videoId = extractYouTubeID(url);
      if (!videoId) return alert("Invalid YouTube URL.");
  
      // Try to get video title (optional)
      fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`)
        .then(res => res.json())
        .then(data => {
          const title = data.title || "Untitled Video";
  
          // Add to queue
          queue.push({ videoId, title });
          updateQueueUI();
  
          alert("ðŸŽ¤ Reserved: " + title);
  
          // Autoplay if first in queue
          if (queue.length === 1) {
            playNextFromDrawer();
          }
        })
        .catch(err => {
          queue.push({ videoId, title: "Unknown Title" });
          updateQueueUI();
          alert("ðŸŽ¤ Reserved! (Title not found)");
  
          if (queue.length === 1) {
            playNextFromDrawer();
          }
          console.error("Title fetch failed:", err);
        });
  
      // Clear input
      document.getElementById("youtubeInputDrawer").value = "";
    }
  
    function playNextFromDrawer() {
      if (queue.length === 0) {
        document.getElementById("nowTitle").textContent = "Nothing in queue.";
        document.getElementById("player").src = "";
        return;
      }
  
      const next = queue.shift(); // Remove first
      updateQueueUI();
  
      // Play video
      const player = document.getElementById("player");
      player.src = `https://www.youtube.com/embed/${next.videoId}?enablejsapi=1&autoplay=1`;
  
      document.getElementById("nowTitle").textContent = next.title;
    }
  
    function updateQueueUI() {
      const nextBox = document.querySelector(".next-box");
      nextBox.innerHTML = `<div class="label">NEXT</div>`;
  
      if (queue.length === 0) {
        const empty = document.createElement("div");
        empty.className = "title";
        empty.textContent = "No songs in queue.";
        nextBox.appendChild(empty);
        return;
      }
  
      queue.forEach(item => {
        const div = document.createElement("div");
        div.className = "title";
        div.textContent = item.title;
        nextBox.appendChild(div);
      });
    }
  
    function extractYouTubeID(url) {
      const match = url.match(/(?:youtu\.be\/|v=)([^&]+)/);
      return match ? match[1] : null;
    }
  
    // Initial state check (e.g., if user is not host)
    if (!isHost) {
      document.getElementById("nextBtnDrawer").style.display = "none";
    }
  </script>

</body>
</html>
