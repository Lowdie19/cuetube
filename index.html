
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CueTube</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2em;
      color: #0ff;
      text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
    }
    input[type="text"] {
      width: 60%;
      padding: 10px;
      font-size: 1em;
    }
    button {
      padding: 10px 20px;
      margin-left: 10px;
      font-size: 1em;
      cursor: pointer;
    }
    #queue {
      margin-top: 30px;
      border-top: 1px solid #444;
      padding-top: 10px;
    }
    .queue-item {
      padding: 8px;
      background: #222;
      border: 1px solid #333;
      margin-bottom: 5px;
    }
    
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Orbitron', sans-serif;
      background-color: #0a0a0a;
      color: white;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    .title-bar {
      text-align: center;
      font-size: 1.6em;
      padding: 12px 0;
      color: white;
      background-color: #000;
      position: relative;
      animation: neon 3.0s ease-in-out infinite alternate;
    }
    @keyframes neon {
      from { text-shadow: 0 0 10px magenta, 0 0 20px magenta; }
      to { text-shadow: 0 0 20px cyan, 0 0 40px cyan; }
    }
    
    .drawer {
      position: fixed;
      top: 0;
      left: -240px;
      width: 220px;
      height: 100%;
      background: rgba(20, 20, 20, 0.90);
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.5);
      z-index: 99;
      transition: left 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 25px;
    }
    .drawer.open { left: 0; }
    
    .drawer-handle {
      position: absolute;
      top: 0%;
      right: -58px;
      width: 50px;
      height: 50px;
      background: rgba(0, 0, 0, 0.0);
      color: magenta;
      font-size: 1.6em;
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: right;
      cursor: pointer;
      z-index: 80;
    }
    
    .nowplaying-box {
      border: 2px solid cyan;
      border-radius: 10px;
      padding: 10px;
      background: #121212;
    }
    
    .nowplaying-box .label {
      font-size: 0.7em;
      color: #aaa;
    }

    .nowplaying-box .title {
      font-family: Arial, sans-serif;
      font-size: 1.1em;
      margin: 5px 0;
      word-wrap: break-word;
      font-weight: bold;
    }
    
    .next-box {
      border: none;
      border-radius: 10px;
      padding: 10px;
      background: #121212;
      flex: 1;
      overflow-y: auto;
      min-height: 0;
      display: flex;
      flex-direction: column;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
      scroll-padding-bottom: 40px;
      touch-action: pan-y;
      cursor: grab;
      scrollbar-width: thin;
      scrollbar-color: transparent transparent;
    }
    .next-box:active {
      cursor: grabbing;
    }
    .next-box::-webkit-scrollbar-thumb {
      background: transparent;
      transition: background 0.3s ease;
    }
    .next-box:hover::-webkit-scrollbar-thumb,
    .next-box.dragging::-webkit-scrollbar-thumb {
      background: cyan;
    }
    .drawer > div {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .drawer.open {
      display: flex;
    }
    .next-box::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 20px;
      background: linear-gradient(to bottom, transparent, #121212);
      pointer-events: none;
      z-index: 1;
    }
    .next-box::-webkit-scrollbar-thumb {
      background: cyan;
    }

    #overflowCounter {
    text-align: center;
    font-size: 0.7em;
    color: #888;
    margin-top: 5px;
    display: none;
    }
    
    .next-box .label {
      font-size: 0.7em;
      color: #aaa;
    }
    
    .next-box .title {
      font-family: Arial, sans-serif;
      font-size: 0.9em;
      margin: 10px 0;
      word-wrap: break-word;
      overflow-wrap: break-word;
      font-weight: normal;
    }
    
    .drawer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.4);
      z-index: 90;
      display: none;
    }
    .drawer-overlay.visible { display: block; }

    .youtube-wrapper {
      width: 100%;
      height: 70vh;
      border: 5px solid cyan;
      margin-top: 2vh;
      margin-bottom: 5vh;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .url-input {
      width: calc(100% - 20px);
      margin: 0 10px 8px 10px;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid cyan;
      font-size: 1em;
      background-color: white;
      color: black;
      text-align: center;
    }

    .bottom-buttons {
      position: fixed;
      bottom: 15px;
      width: 100%;
      padding: 0 10px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      z-index: 5;
    }

    .cyan-btn {
      flex: 1;
      padding: 14px;
      background: #121212;
      border: 2px solid cyan;
      border-radius: 10px;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: 0.3s;
    }

    .cyan-btn:hover {
      background: cyan;
      color: black;
    }
    
    .bottom-drawer {
      position: fixed;
      bottom: -160px;
      left: 0;
      width: 100%;
      background: rgba(20, 20, 20, 0.95);
      padding: 20px 15px 25px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
      transition: bottom 0.3s ease;
      z-index: 98;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .bottom-drawer.open {
      bottom: 0;
    }
    
    .bottom-drawer-handle {position: absolute;
      top: -70px;
      left: 50%;
      transform: translateX(-50%);
      background: none;
      border: none;
      color: magenta;
      font-size: 1.8em;
      cursor: pointer;
      text-shadow: none; //* text-shadow: 0 0 6px magenta, 0 0 12px magenta; *//
      z-index: 99;
      transition: opacity 0.3s ease;
    }
    .bottom-drawer-handle[style*="display: none"] {
      opacity: 0;
    }
    
    .bottom-buttons.inside {
      position: relative;
      bottom: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }
    
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      border: 2px solid red;
      border-radius: 10px;
      padding: 20px;
      z-index: 1000;
      text-align: center;
      width: 90%;
      max-width: 320px;
      box-shadow: 0 0 20px red;
    }
    
    .single-btn {
      width: 45%;
      max-width: 200px;
    }

    @media (orientation: landscape) {
      .youtube-wrapper {
        height: 75vh;
      }
      .drawer {
        height: 100vh; /* Full screen height in landscape */
        justify-content: space-between; /* Keep space for top + bottom parts */
        padding-bottom: 20px; /* Add some space at the bottom */
      }
      .url-input, .search-bar {
        display: block; /* Make sure it's visible */
      }
    }
    
    @media (max-height: 500px) {
      .bottom-buttons { position: static; margin-top: 20px; }
    }
    
    @media (hover: hover) {
      .next-box::-webkit-scrollbar-thumb {
        background: transparent;
      }
      .next-box:hover::-webkit-scrollbar-thumb {
        background: cyan;
      }
    }
    
    #popupModal {
      display: none;
      position: fixed;
      top: 35%;
      left: 50%;
      transform: translateX(-50%) scale(0.8);
      font-size: 1.5em;
      font-weight: bold;
      text-align: center;
      z-index: 300;
      pointer-events: none;
      opacity: 0;
      color: white;
      transition: opacity 0.4s ease, transform 0.4s ease;
      text-shadow: 0 0 10px lime, 0 0 20px lime, 0 0 35px lime;
    }
      
    #popupModal.show {
      display: block;
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }
    
    #popupOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      z-index: 250;
      display: none;
      transition: opacity 0.4s ease;
    }

    #popupOverlay.visible {
      display: block;
    }
    
    #confirmDelete {
    transition: opacity 0.3s ease;
    opacity: 1;
    }
    
    #confirmDelete.show {
      opacity: 1;
    }
    
    .long-pressing {
    box-shadow: 0 0 7px red;
    }
      
  </style>
</head>
<body ontouchstart="handleTouchStart(event)" ontouchmove="handleTouchMove(event)" onclick="handleTap(event)">

  <!-- Title -->
  <div class="title-bar">CueTube!</div>
  <button class="cyan-btn" onclick="clearQueue()">Clear Queue</button>
  
  <!-- Drawer -->
  <div class="drawer" id="drawer">
    <div id="drawerHandle" class="drawer-handle" onclick="toggleDrawer()">☰</div>
    <div>
      <div class="nowplaying-box">
        <div class="label">NOW PLAYING</div>
        <div class="title" id="nowTitle">...</div>
      </div>
      <div class="next-box" id="nextBox">
        <div class="label">NEXT</div>
        <div id="nextList"></div>
        <div id="overflowCounter"></div>
      </div>
    </div>
  </div>
  
  <!-- Overlays -->
  <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
  <div class="drawer-overlay" id="bottomDrawerOverlay" onclick="closeBottomDrawer()"></div>

  <!-- YouTube Player -->
  <div class="youtube-wrapper">
    <iframe id="player" src="https://www.youtube.com/embed/?enablejsapi=1&controls=1&autoplay=1&rel=0&modestbranding=1"></iframe>
  </div>

  <!-- Bottom Drawer -->
  <div class="bottom-drawer" id="bottomDrawer">
  <button class="bottom-drawer-handle" onclick="toggleBottomDrawer()">_</button>
  <input type="text" class="url-input" placeholder="Paste the YouTube URL here" id="youtubeInputDrawer" />
  <div class="bottom-buttons inside">
    <button class="cyan-btn" onclick="reserveFromDrawer()">Reserve</button>
    <button class="cyan-btn" id="nextBtnDrawer" onclick="showNextConfirm()">Next</button>
  </div>
  </div>
  
  <!-- Popup -->
  <div id="popupOverlay"></div>
  <div id="popupModal">Reserved!</div>

  <!-- Delete Confirm Box -->
  <div id="confirmDelete" style="display:none; position:absolute; background:#333; padding:10px; border-radius:6px; z-index:999;">
    <div style="font-family:Arial,sans-serif; color:white; font-size:1em; margin-bottom:8px; text-align:center;">Delete?</div>
    <div style="display:flex; gap:10px;">
      <button id="yesBtn" style="font-family:Arial,sans-serif; font-weight:bold; background-color:lime; color:white; padding:6px 12px; border-radius:6px; border:none; cursor:pointer;">✓</button>
      <button id="noBtn" style="font-family:Arial,sans-serif; font-weight:bold; background-color:red; color:white; padding:6px 12px; border-radius:6px; border:none; cursor:pointer;">✗</button>
    </div>
  </div>
  
  <!-- Next Confirm Modal -->
  <div id="nextConfirmOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:999;"></div>
  <div id="nextConfirmModal" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #222;
  border: 2px solid cyan;
  border-radius: 10px;
  padding: 20px;
  z-index: 1000;
  text-align: center;
  width: 90%;
  max-width: 320px;
  box-shadow: 0 0 20px rgba(0,255,255,0.3);
">
  <div id="nextConfirmText" style="font-size: 1.1em; color: white; margin-bottom: 20px;">
    Are you sure you want to skip to the next video?
  </div>
  <div style="display: flex; justify-content: space-between;">
    <button class="cyan-btn" style="flex:1; margin-right: 5px;" onclick="confirmPlayNext()">Confirm</button>
    <button class="cyan-btn" style="flex:1; margin-left: 5px;" onclick="hideNextConfirm()">Cancel</button>
  </div>
</div>

<!-- Exit Confirmation Modal -->
<div id="exitConfirmOverlay" class="overlay" style="display:none;"></div>
<div id="exitConfirmModal" class="modal" style="display:none;">
  <div class="modal-content">
    <p style="color: white; margin: 5px 0 2px;">Are you sure you want to exit?</p>
    <p style="color: white; margin: 0 0 18px;">All reserved will be deleted.</p>
    <p style="color: #ff4c4c; margin: 22px 0 26px;">click back button to exit</p>
    
    <div class="modal-buttons" style="justify-content: center;">
      <button class="cyan-btn single-btn" onclick="hideExitConfirm()">Cancel</button>
    </div>
  </div>
</div>

  <audio id="clickSound" src="click.wav" preload="auto"></audio>
  <audio id="successSound" src="success.wav" preload="auto"></audio>
  <audio id="errorSound" src="error.wav" preload="auto"></audio>
  
  <!-- JS -->
<script>
  let player;
  let queue = [];
  let currentIndex = -1;

  function onYouTubeIframeAPIReady() {
    player = new YT.Player("player", {
      height: "0",
      width: "0",
      playerVars: {
        autoplay: 1,
        controls: 1,
        modestbranding: 1,
        rel: 0,
        enablejsapi: 1
      },
      events: {
        onReady: onPlayerReady,
        onStateChange: onPlayerStateChange
      }
    });
  }

  function onPlayerReady() {
    restoreQueueFromLocalStorage(); // Load queue on startup
  }

  function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.ENDED) {
      playNextFromQueue();
    }
  }

  function saveQueueToLocalStorage() {
    localStorage.setItem("cueTubeQueue", JSON.stringify(queue));
    localStorage.setItem("cueTubeIndex", currentIndex.toString());
  }

  function restoreQueueFromLocalStorage() {
    const savedQueue = localStorage.getItem("cueTubeQueue");
    const savedIndex = localStorage.getItem("cueTubeIndex");

    if (savedQueue) {
      queue = JSON.parse(savedQueue);
      currentIndex = savedIndex ? parseInt(savedIndex) : 0;

      if (queue[currentIndex]) {
        player.loadVideoById(queue[currentIndex].id);
        updateNowPlaying();
        updateQueueDisplay();
      }
    }
  }

  function reserveFromDrawer() {
    const url = document.getElementById("youtubeUrl").value;
    const videoId = extractVideoID(url);

    if (videoId) {
      fetchVideoTitle(videoId, (title) => {
        queue.push({ id: videoId, title: title });
        if (currentIndex === -1) {
          currentIndex = 0;
          player.loadVideoById(videoId);
        }
        updateNowPlaying();
        updateQueueDisplay();
        saveQueueToLocalStorage(); // Save change
        document.getElementById("youtubeUrl").value = "";
        showPopup("Video Reserved ✔", "lime");
        playSound("success.mp3");
      });
    } else {
      showPopup("Invalid YouTube URL", "red");
      playSound("error.mp3");
    }
  }

  function playNextFromQueue() {
    if (currentIndex + 1 < queue.length) {
      currentIndex++;
      player.loadVideoById(queue[currentIndex].id);
      updateNowPlaying();
      updateQueueDisplay();
      saveQueueToLocalStorage(); // Save index update
    }
  }

  function confirmPlayNext() {
    document.getElementById("confirmSkipModal").style.display = "block";
  }

  function confirmDelete(index) {
    const modal = document.getElementById("confirmDeleteModal");
    modal.style.display = "block";

    const yes = document.getElementById("deleteYes");
    const no = document.getElementById("deleteNo");

    yes.onclick = () => {
      if (index >= 0 && index < queue.length) {
        queue.splice(index, 1);
        if (index <= currentIndex && currentIndex > 0) currentIndex--;
        updateQueueDisplay();
        updateNowPlaying();
        saveQueueToLocalStorage(); // Save after delete
        modal.style.display = "none";
      }
    };

    no.onclick = () => {
      modal.style.display = "none";
    };
  }

  function clearQueue() {
    queue = [];
    currentIndex = -1;
    localStorage.removeItem("cueTubeQueue");
    localStorage.removeItem("cueTubeIndex");
    updateNowPlaying();
    updateQueueDisplay();
    player.stopVideo();
    showPopup("Queue cleared", "red");
  }

  function extractVideoID(url) {
    const match = url.match(/[?&]v=([^&]+)/) || url.match(/youtu\.be\/([^?&]+)/);
    return match ? match[1] : null;
  }

  function fetchVideoTitle(videoId, callback) {
    const iframe = document.createElement("iframe");
    iframe.style.display = "none";
    iframe.src = `https://www.youtube.com/embed/${videoId}`;
    document.body.appendChild(iframe);
    setTimeout(() => {
      callback(`Video: ${videoId}`);
      document.body.removeChild(iframe);
    }, 500);
  }

  function updateNowPlaying() {
    const nowBox = document.getElementById("nowBox");
    const glow = document.getElementById("nowPlayingGlow");
    nowBox.innerHTML = "";

    if (currentIndex >= 0 && currentIndex < queue.length) {
      const div = document.createElement("div");
      div.className = "title";
      div.textContent = queue[currentIndex].title;
      nowBox.appendChild(div);
      glow.classList.add("glow");
    } else {
      glow.classList.remove("glow");
    }
  }

  function updateQueueDisplay() {
    const list = document.getElementById("nextList");
    const overflow = document.getElementById("overflowCounter");
    list.innerHTML = "";

    for (let i = currentIndex + 1; i < queue.length; i++) {
      const div = document.createElement("div");
      div.className = "title";
      div.textContent = queue[i].title;
      div.style.cursor = "pointer";

      let pressTimer;
      div.addEventListener("mousedown", () => {
        pressTimer = setTimeout(() => confirmDelete(i), 1000);
      });
      div.addEventListener("mouseup", () => clearTimeout(pressTimer));
      div.addEventListener("mouseleave", () => clearTimeout(pressTimer));
      div.addEventListener("touchstart", () => {
        pressTimer = setTimeout(() => confirmDelete(i), 1000);
      });
      div.addEventListener("touchend", () => clearTimeout(pressTimer));
      list.appendChild(div);
    }

    const overflowCount = queue.length - (currentIndex + 1);
    overflow.style.display = overflowCount > 5 ? "block" : "none";
    overflow.textContent = `${overflowCount - 5}+ more`;
  }

  function showPopup(message, color) {
    const popup = document.getElementById("popup");
    popup.textContent = message;
    popup.style.color = color;
    popup.style.display = "block";
    setTimeout(() => {
      popup.style.display = "none";
    }, 2000);
  }

  function playSound(file) {
    const audio = new Audio(`assets/${file}`);
    audio.play();
  }

  window.addEventListener("beforeunload", (e) => {
    e.preventDefault();
    e.returnValue = "";
  });
</script>
  <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
